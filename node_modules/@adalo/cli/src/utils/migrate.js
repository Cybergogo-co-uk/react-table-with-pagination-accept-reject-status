const path = require('path')
const fs = require('fs')
const util = require('util')

const readFile = util.promisify(fs.readFile)
const writeFile = util.promisify(fs.writeFile)

const migrate = async () => {
  const pkgPath = path.join(process.cwd(), 'package.json')
  const pkg = JSON.parse(await readFile(pkgPath))
  const { author, description } = pkg
  const adaloConfig = pkg.adalo || pkg.proton

  const newAdaloConfig = {
    author,
    description,
    ...adaloConfig,
  }

  delete pkg.adalo
  delete pkg.proton

  const adaloConfigPath = path.join(process.cwd(), 'adalo.json')

  await writeFile(adaloConfigPath, JSON.stringify(newAdaloConfig, null, 2))
  await writeFile(pkgPath, JSON.stringify(pkg, null, 2))
}

module.exports = { migrate }
